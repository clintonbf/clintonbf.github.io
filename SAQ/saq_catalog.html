<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View our catalogue</title>

    <!-- init firebase mega thing-->
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
    <!-- init firestore -->
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
    <!-- init SAQ firebase -->
    <script src="firebase_config.js"></script>
    <!-- init SAQ objects -->
    <script src="SAQ_objects.js"></script>
    <script src="SAQ_functions.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script>
        //Create a JSON array of all of the chair objects
        let chair_arr = create_chairs_array();
        //localStorage.setItem('cart_items', JSON.stringify(chair_arr));
    </script>
</head>
<body>
<div class = "jumbotron jumbotron-fluid" style = "background-color: gray; margin-bottom: 0px">
    <div class = "container"><img style = "height: 50px" src="images/home_page/iconchair.png" alt = "chair-icon">
        <h1 class="display-4" style="color: white;"> Site Title </h1></div>

    <form><div class ="form-group" style="padding: 5px"><input type="email" class="form-control" id="searchbar"
                                                               aria-describedby="search" placeholder="Search Catalouge">
        <br><div id = "ourCart" class="container" style = "background-color: grey;"><button type = "button" class="btn btn-outline-secondary" style="background-color: #3c3f41; padding: 15px; width: 100px; position: absolute; left: 70%">
            <a href="shopping_cart.html" style = "color: white"><p id = "cart"> Cart </p></a></button><div></div>
        </div>
    </div></form></div>

    <div id="clint" class="container" style="background-color: black; padding: 5px; color:white;">
        <table class="display-4" style = "font-size: large">
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="clint_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="clint_name"></td></tr>
                        <tr><td id="clint_comfort_options"></td></tr>
                        <tr><td id="clint_price"></td><td id="clint_rating"></td></tr>
                        <tr><td><div id = "clintAdd" class="quickadd" style ="padding: 3px"> quick add </div></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="fahad" class="container" style="background-color: black; padding: 5px; color:white;">
        <table class="display-4" style = "font-size: large">
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="fahad_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="fahad_name"></td></tr>
                        <tr><td id="fahad_comfort_options"></td></tr>
                        <tr><td id="fahad_price"></td><td id="fahad_rating"></td></tr>
                        <tr><td><div id = "fahadAdd" class="quickadd"> quick add </div></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="em" class="container" style="background-color: black; padding: 5px; color:white;">
        <table class="display-4" style = "font-size: large">
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="em_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="em_name"></td></tr>
                        <tr><td id="em_comfort_options"></td></tr>
                        <tr><td id="em_price"></td><td id="em_rating"></td></tr>
                        <tr><td><div id = "emAdd" class="quickadd"> quick add </div></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="neda" class="container" style="background-color: black; padding: 5px; color:white;">
        <table class="display-4" style = "font-size: large">
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="neda_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>

                    <table class= "chair_info">
                        <tr><td id="neda_name"></td></tr>
                        <tr><td id="neda_comfort_options"></td></tr>
                        <tr><td id="neda_price"></td><td id="neda_rating"></td></tr>
                        <tr><td><div id="nedaAdd" class="quickadd"> quick add </div></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="sam" class="container" style="background-color: black; padding: 5px; color:white;">
        <table class="display-4" style = "font-size: large">
            <tr>
                <td>
                    <table class="picture">
                        <tr><td><img id="sam_pic" height="100" width="100"></td></tr>
                    </table>
                </td>
                <td>
                    <table class= "chair_info">
                        <tr><td id="sam_name"></td></tr>
                        <tr><td id="sam_comfort_options"></td></tr>
                        <tr><td id="sam_price"></td><td id="sam_rating"></td></tr>
                        <tr><td><div id="samAdd" class="quickadd"> quick add </div></td></tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <div id="chris" class="container" style="background-color: black; padding: 5px; color:white;">
    <table class="display-4" style = "font-size: large">
        <tr>
            <td>
                <table class="picture">
                    <tr><td><img class = "img-fluid" id="chris_pic" height="100" width="100"></td></tr>
                </table>
            </td>
            <td>
                <table class= "chair_info">
                    <tr><td id="chris_name"></td></tr>
                    <tr><td id="chris_comfort_options"></td></tr>
                    <tr><td id="chris_price"></td><td id="chris_rating"></td></tr>
                    <tr><td><div id = "chrisAdd" class="quickadd"> quick add </div></td></tr>
                </table>
            </td>
        </tr>
    </table>
</div>



    <script>var the_db = firebase.firestore();</script>
    <script>
    let selectedChairs = [];
    let cartCount = 0;
        // Get a prefix based on the chair name
        function get_prefix(chair_name) {
            if (chair_name === 'the Clint') {
                return 'clint_';
            }
            else if (chair_name === 'the Fahad') {
                return 'fahad_';
            }
            else if (chair_name === 'the Em') {
                return 'em_';
            }
            else if (chair_name === 'the Neda') {
                return 'neda_';
            }
            else if (chair_name === 'the Sam') {
                return 'sam_';
            }
            else if (chair_name === 'the Chris') {
                return 'chris_';
            }
        }

        // Calculate an average
        function calculate_average(arr) {
            let sum = 0;

            for (let i = 0; i < arr.length; i++) {
                sum += arr[i];
            }

            return Math.floor(sum/arr.length);
        }

        // Get a chair from the DB
        function get_single_chair(chair_id) {
            let db_ref = the_db.collection("Chairs").doc(chair_id);

            db_ref.get().then(function(doc){
                if (doc.exists){
                    let ratings =  doc.data().ratings;
                    let options = [doc.data().firmness,  doc.data().back_support, doc.data().arms];
                    //id, name, price, comfort_options, ratings, picture
                    let chair = new Chair(doc.data().id, doc.data().name, doc.data().price, options, ratings, doc.data().picture);

                    document.getElementById('chair_name').innerHTML = chair.name;
                    document.getElementById('price').innerHTML = "$" + chair.price;
                    document.getElementById('rating').innerHTML = chair.ratings;
                    document.getElementById('pic').src = chair.picture;
                }
                else {
                    console.log("Didn't work");
                }
            }).catch(function(error) {
                console.log("Threw error " + error);
            });
        }

        function display_catalog() {
            let db_ref = the_db.collection("clints_work"); // ToDo <----- replace with live Collection

            db_ref.get().then(function(catalog) {
               // Create a div area and put the chair into it
               catalog.forEach(function(doc){
                   let name = doc.data().name;
                   let prefix = get_prefix(name);

                   document.getElementById(prefix + "name").innerHTML = name;
                   document.getElementById(prefix + "price").innerHTML = '$' + doc.data().price;
                   document.getElementById(prefix + "rating").innerHTML = "Average rating: " + calculate_average(doc.data().ratings);
                   document.getElementById(prefix + "pic").src = doc.data().picture;
               })
            }).catch(function(error) {
                console.log("Error displaying all items");
            });
        }

        // get_single_chair("chair_0");
        display_catalog();

        function display_catalog_dynamic() {
            let db_ref = the_db.collection("clints_work"); // ToDo <----- replace with live Collection

            db_ref.get().then(function(catalog) {
                // Create a div area and put the chair into it
                catalog.forEach(function(doc){
                    let name = doc.data().name;
                    let prefix = get_prefix(name);


                    let displayname = document.createElement("p");
                        // create a <p> node
                    let text = document.createTextNode(name); // the text node
                    displayname.appendChild(text);
                    document.body.appendChild(displayname);

                    document.getElementById(prefix + "name").innerHTML = name;
                    document.getElementById(prefix + "price").innerHTML = '$' + doc.data().price;
                    document.getElementById(prefix + "rating").innerHTML = "Average rating: " + calculate_average(doc.data().ratings);
                    document.getElementById(prefix + "pic").src = doc.data().picture;
                })
            }).catch(function(error) {
                console.log("Error displaying all items");
            });
        }
        // Code to insert chair info into web-page
        // get_single_chair("chair_0");
        display_catalog();


        function filter_by_price() {
            // Use JS to loop through the chairs_array
            // and set the CSS display:none property according to the filter-criteria and the element_id

            let min_price = document.getElementById('min_price');
            let max_price = document.getElementById('max_price');

            //Set a CSS display property to hidden or visible


        }


    </script>

<script>
    document.getElementById("clintAdd").addEventListener("click", function() {
        AddChairClint("chair_0");
    });
    document.getElementById("fahadAdd").addEventListener("click", function() {
        AddChairFahad("chair_1");});
    document.getElementById("emAdd").addEventListener("click", function() {
        AddChairEm("chair_2");});
    document.getElementById("nedaAdd").addEventListener("click", function() {
        AddChairNeda("chair_3");});
    document.getElementById("samAdd").addEventListener("click", function() {
        AddChairSam("chair_4");});
    document.getElementById("chrisAdd").addEventListener("click", function() {
        AddChairChris("chair_5");});


    function AddChairClint(doc) {
        var dbRef = the_db.collection("clints_work").get().then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                if ("the Clint" === doc.data().name) {
                    selectedChairs.push(doc.data());
                    console.log(selectedChairs);
                    cartCount ++;
                    document.getElementById('cart').innerHTML = "Cart: " + cartCount.toString();
                    console.log("works")
                }
            })
            //     .catch(function (error) {
            //     console.log("Error displaying all items");
            // })
        })
    }

    function AddChairFahad(doc) {

        var dbRef = the_db.collection("clints_work").get().then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                if ("the Fahad" === doc.data().name) {
                    selectedChairs.push(doc.data());
                    console.log(selectedChairs);
                    cartCount ++;
                    document.getElementById('cart').innerHTML = "Cart <br>" + cartCount.toString();
                    console.log("works")
                }
            })
            //     .catch(function (error) {
            //     console.log("Error displaying all items");
            // })
        })
    }


    function AddChairEm(doc) {

        var dbRef = the_db.collection("clints_work").get().then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                if ("the Em" === doc.data().name) {
                    selectedChairs.push(doc.data());
                    console.log(selectedChairs);
                    cartCount ++;
                    document.getElementById('cart').innerHTML = "Cart <br>" + cartCount.toString();
                    console.log("works")
                }
            })
            //     .catch(function (error) {
            //     console.log("Error displaying all items");
            // })
        })
    }

    function AddChairNeda(doc) {
        var dbRef = the_db.collection("clints_work").get().then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                if ("the Neda" === doc.data().name) {
                    selectedChairs.push(doc.data());
                    console.log(selectedChairs);
                    cartCount ++;
                    document.getElementById('cart').innerHTML = "Cart <br>" + cartCount.toString();
                    console.log("works")
                }
            })
            //     .catch(function (error) {
            //     console.log("Error displaying all items");
            // })
        })
    }

    function AddChairSam(doc) {
        var dbRef = the_db.collection("clints_work").get().then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                if ("the Sam" === doc.data().name) {
                    selectedChairs.push(doc.data());
                    console.log(selectedChairs);
                    cartCount ++;
                    document.getElementById('cart').innerHTML = "Cart <br>" + cartCount.toString();
                    console.log("works")
                }
            })
            //     .catch(function (error) {
            //     console.log("Error displaying all items");
            // })
        })
    }

    function AddChairChris(doc) {
        var dbRef = the_db.collection("clints_work").get().then(function (querySnapshot) {
            querySnapshot.forEach(function (doc) {
                if ("the Chris" === doc.data().name) {
                    selectedChairs.push(doc.data());
                    console.log(selectedChairs);
                    cartCount ++;
                    document.getElementById('cart').innerHTML = "Cart <br>" + cartCount.toString();
                    console.log("works")
                }
            })
            //     .catch(function (error) {
            //     console.log("Error displaying all items");
            // })
        })
    }

    document.getElementById("ourCart").addEventListener("click", function() {
        storeCart(selectedChairs);});

    function storeCart(array){
        localStorage.setItem('cartItems', JSON.stringify(array));
    }
</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</body>
</html>